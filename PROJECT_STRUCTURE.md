# Архитектура и структура проекта Movie-Lottery V2

Этот документ описывает новую модульную структуру проекта, созданную в результате рефакторинга.

## 1. Обзор

Проект разделен на две основные части:
- **Бэкенд (Python/Flask)**: Находится в пакете `movie_lottery/`. Использует паттерн "Фабрика приложений" для создания и конфигурации.
- **Фронтенд (Vanilla JS)**: Находится в `movie_lottery/static/`. Разделен на модули для API-запросов, переиспользуемых компонентов и "сборочных" скриптов для каждой страницы.

---

## 2. Структура Бэкенда (`/movie_lottery`)

- **`run.py` (в корне)**: **Точка входа.** Единственный файл, который нужно запускать. Он импортирует и запускает приложение из пакета `movie_lottery`.

- **`__init__.py`**: **Фабрика приложений.** Здесь создается экземпляр Flask, инициализируются расширения (например, база данных) и, самое главное, регистрируются все маршруты (`Blueprints`).

- **`config.py`**: **Конфигурация.** Содержит все настройки: ключи API, пути к базе данных, доступы к qBittorrent.

- **`models.py`**: **Модели данных.** Описание всех таблиц базы данных через классы SQLAlchemy (`Lottery`, `Movie`, `LibraryMovie` и т.д.).

- **`/routes`**: Папка для всей логики маршрутизации.
    - `main_routes.py`: Отвечает за маршруты, которые **отрисовывают HTML-страницы** (например, главная, история, библиотека).
    - `api_routes.py`: Отвечает за все **API-маршруты** (те, что возвращают данные в формате JSON для JavaScript).

- **`/utils`**: Папка для вспомогательных функций.
    - `qbittorrent.py`: Вся логика для взаимодействия с qBittorrent.
    - `kinopoisk.py`: Логика для запросов к API Кинопоиска.
    - `helpers.py`: Прочие вспомогательные функции (генерация ID, работа с фоном и т.д.).

---

## 3. Структура Фронтенда (`/movie_lottery/static`)

### CSS (`/css`)
- **`style.css`**: **Главный файл.** Не содержит стилей, только импортирует все остальные части.
- **`/base`**: Базовые стили (переменные, стили для `body`, скроллбара).
- **`/components`**: Стили для каждого конкретного компонента (`_buttons.css`, `_modal.css`, `_slider.css` и т.д.).

### JavaScript (`/js`)
- **`/api`**: **Слой для работы с API.** Содержит функции, которые отправляют `fetch`-запросы на бэкенд. Каждый файл отвечает за свою группу запросов (`movies.js`, `torrents.js`).
- **`/components`**: **Переиспользуемые компоненты.** Модули, отвечающие за конкретные элементы интерфейса (`modal.js`, `slider.js`, `statusWidget.js`).
- **`/pages`**: **"Сборщики" страниц.** Главные скрипты для каждой страницы (`history.js`, `library.js`). Они импортируют нужные API-функции и компоненты и связывают их воедино.
- **Корневая папка `/js`**: Содержит общие скрипты, используемые на многих страницах (`toast.js`, `background.js`), и скрипты для простых страниц (`main.js`, `play.js`).

---