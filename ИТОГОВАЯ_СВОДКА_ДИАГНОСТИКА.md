# üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è + –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

**–î–∞—Ç–∞:** 1 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** Worker timeout –∏ OOM kills –Ω–∞ Render

---

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ (`movie_lottery/__init__.py`)
- ‚ùå **–£–±—Ä–∞–Ω–æ:** `db.create_all()` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ
- ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞–ø—É—Å–∫ –Ω–∞ 5-10 —Å–µ–∫—É–Ω–¥ –±—ã—Å—Ç—Ä–µ–µ

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ (`movie_lottery/config.py`)
- ‚úÖ `pool_size = 1` (–±—ã–ª–æ: –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
- ‚úÖ `max_overflow = 0` (–±—ã–ª–æ: –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è:** 40-120 MB RAM

### 3. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ (`gunicorn_config.py`)
- ‚úÖ `timeout = 300` —Å–µ–∫—É–Ω–¥ (–±—ã–ª–æ: 30 —Å–µ–∫—É–Ω–¥)
- ‚úÖ `worker_connections = 100` (–±—ã–ª–æ: 1000)
- ‚úÖ `max_requests = 500` (–±—ã–ª–æ: 1000)

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (`/health` endpoint)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω endpoint –¥–ª—è Render health checks
- ‚úÖ URL: `https://your-app.onrender.com/health`

---

## üîç –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ: –°–∏—Å—Ç–µ–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –§–∞–π–ª 1: `diagnostic_startup.py`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
```bash
python diagnostic_startup.py
```

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- ‚è±Ô∏è –í—Ä–µ–º—è –∫–∞–∂–¥–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
- üíæ –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- üéØ –ì–¥–µ "—É–∑–∫–æ–µ –º–µ—Å—Ç–æ"

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
‚úì Import: Flask                          |   0.12s |   52.3 MB | + 7.1 MB
‚úì Import: SQLAlchemy                     |   0.45s |   68.9 MB | +23.7 MB
‚ö† Import: qbittorrentapi                 |  12.34s |  340.2 MB | +295.0 MB  ‚ö†Ô∏è
```

---

### –§–∞–π–ª 2: `movie_lottery/diagnostic_middleware.py`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ω–∞ Render

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Render (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `RENDER=true`)
- –õ–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π —à–∞–≥ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è –∏ –ø–∞–º—è—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç:**
```
[DIAGNOSTIC] üîç STARTUP DIAGNOSTICS ENABLED
[DIAGNOSTIC] [OK] create_app() started      |   0.05s |   48.1 MB | +  2.9 MB
[DIAGNOSTIC] [OK] SQLAlchemy initialized    |   0.45s |   68.9 MB | + 23.7 MB
[DIAGNOSTIC] [SLOW] api_routes imported     |  28.34s |  420.5 MB | +375.3 MB ‚ö†Ô∏è
```

---

### –§–∞–π–ª 3: –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `movie_lottery/__init__.py`
**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
```python
from .diagnostic_middleware import start_diagnostics, checkpoint, finish_diagnostics
_diag = start_diagnostics()

# ... –≤–Ω—É—Ç—Ä–∏ create_app():
checkpoint("create_app() started")
checkpoint("Flask instance created")
checkpoint("Config loaded")
# ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
```

–ö–∞–∂–¥–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç:
- –í—Ä–µ–º—è —Å –º–æ–º–µ–Ω—Ç–∞ —Å—Ç–∞—Ä—Ç–∞
- –¢–µ–∫—É—â–µ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –ü—Ä–∏—Ä–æ—Å—Ç –ø–∞–º—è—Ç–∏

---

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### ‚úÖ –®–ê–ì 1: –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

```bash
git add .
git commit -F COMMIT_MESSAGE_MEMORY_FIX.txt
git push origin main
```

### ‚ö†Ô∏è –®–ê–ì 2: –û–±–Ω–æ–≤–∏—Ç—å Start Command –Ω–∞ Render

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!** –ë–µ–∑ —ç—Ç–æ–≥–æ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç!

1. –û—Ç–∫—Ä—ã—Ç—å: https://dashboard.render.com
2. –í—ã–±—Ä–∞—Ç—å —Å–µ—Ä–≤–∏—Å "movie-lottery"
3. –ù–∞–∂–∞—Ç—å **Settings**
4. –ù–∞–π—Ç–∏ **Start Command**
5. –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞:
   ```bash
   gunicorn --config gunicorn_config.py "movie_lottery:create_app()"
   ```
6. –ù–∞–∂–∞—Ç—å **Save Changes**

### ‚úÖ –®–ê–ì 3: –î–æ–∂–¥–∞—Ç—å—Å—è –¥–µ–ø–ª–æ—è –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å—Ç—Ä–æ–∫–∏:
```
[DIAGNOSTIC] üîç STARTUP DIAGNOSTICS ENABLED
[DIAGNOSTIC] [OK] create_app() started ...
[DIAGNOSTIC] DIAGNOSTIC SUMMARY:
[DIAGNOSTIC]   Total startup time: 2.36s
[DIAGNOSTIC]   Final memory: 143.2 MB
```

### ‚úÖ –®–ê–ì 4: –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –í–°–ï –ª–æ–≥–∏ —Å [DIAGNOSTIC] –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–Ω–µ

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
[CRITICAL] WORKER TIMEOUT (pid:123)
[ERROR] Worker was sent SIGKILL! Perhaps out of memory?
```
- ‚ùå Timeout —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
- ‚ùå –ü–∞–º—è—Ç—å: 400-600 MB
- ‚ùå –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
[INFO] Starting gunicorn 23.0.0
[INFO] Booting worker with pid: 123
[DIAGNOSTIC] Total startup time: 8.45s
[DIAGNOSTIC] Final memory: 187.3 MB
==> Your service is live üéâ
```
- ‚úÖ –ó–∞–ø—É—Å–∫ –∑–∞ 8-15 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ü–∞–º—è—Ç—å: 150-250 MB
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

---

## üìñ –ö–∞–∫ —á–∏—Ç–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏

### –§–æ—Ä–º–∞—Ç:
```
[DIAGNOSTIC] [STATUS] –ù–∞–∑–≤–∞–Ω–∏–µ —ç—Ç–∞–ø–∞ | –í—Ä–µ–º—è | –ü–∞–º—è—Ç—å | –ü—Ä–∏—Ä–æ—Å—Ç
```

### –°—Ç–∞—Ç—É—Å—ã:
- `[OK]` - –í—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ (< 10 —Å–µ–∫—É–Ω–¥)
- `[SLOW]` - –ú–µ–¥–ª–µ–Ω–Ω–æ (> 10 —Å–µ–∫—É–Ω–¥)
- `[HIGH_MEMORY]` - –ú–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏ (> 400 MB)

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:
- `‚ö†Ô∏è approaching timeout!` - –°–∫–æ—Ä–æ –±—É–¥–µ—Ç timeout
- `‚ö†Ô∏è approaching 512 MB limit!` - –ü–∞–º—è—Ç—å –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏:
- `üö® CRITICAL: Startup time > 30s` - –ü—Ä–µ–≤—ã—à–µ–Ω —Ç–∞–π–º–∞—É—Ç
- `üö® CRITICAL: Memory > 450 MB` - –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏

---

## üîß –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
python diagnostic_startup.py
```

–ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ –≤—Å—ë –±—ã—Å—Ç—Ä–æ (< 5 —Å–µ–∫—É–Ω–¥), –Ω–æ –Ω–∞ Render –º–µ–¥–ª–µ–Ω–Ω–æ - –ø—Ä–æ–±–ª–µ–º–∞ –≤:
- –ú–µ–¥–ª–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –Ω–∞ Render
- –ú–µ–¥–ª–µ–Ω–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ—Ö–≤–∞—Ç–∫–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (free tier)

---

## üì§ –ß—Ç–æ –º–Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ Render:

1. –û—Ç–∫—Ä—ã—Ç—å –ª–æ–≥–∏ (–≤–∫–ª–∞–¥–∫–∞ "Logs")
2. –ù–∞–π—Ç–∏ —Å–µ–∫—Ü–∏—é —Å `[DIAGNOSTIC]`
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å **–í–°–ï** —Å—Ç—Ä–æ–∫–∏ —Å `[DIAGNOSTIC]`
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –º–Ω–µ

–ü—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å:
```
[DIAGNOSTIC] üîç STARTUP DIAGNOSTICS ENABLED
[DIAGNOSTIC]    Python: 3.11.5
[DIAGNOSTIC]    PID: 123
[DIAGNOSTIC] [OK] Diagnostics initialized ...
[DIAGNOSTIC] [OK] create_app() started ...
[DIAGNOSTIC] [OK] Flask instance created ...
... (–≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å [DIAGNOSTIC])
[DIAGNOSTIC] DIAGNOSTIC SUMMARY:
[DIAGNOSTIC]   Total startup time: 8.45s
[DIAGNOSTIC]   Final memory: 187.3 MB
```

---

## üí° –ü–æ—á–µ–º—É —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç

–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∂–µ—Ç:
- **–ß—Ç–æ –∏–º–µ–Ω–Ω–æ** —Ç–æ—Ä–º–æ–∑–∏—Ç –∑–∞–ø—É—Å–∫
- **–ö–∞–∫–æ–π –º–æ–¥—É–ª—å** –∂—Ä—ë—Ç –ø–∞–º—è—Ç—å
- **–ì–¥–µ** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∑–∞–¥–µ—Ä–∂–∫–∞
- **–ß—Ç–æ** –Ω—É–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å

–í–º–µ—Å—Ç–æ –≥–∞–¥–∞–Ω–∏—è - —Ç–æ—á–Ω—ã–µ —Ü–∏—Ñ—Ä—ã! üéØ

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫–ª–∏—Å—Ç

- [ ] –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å –∫–æ–¥
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Start Command –Ω–∞ Render
- [ ] –î–æ–∂–¥–∞—Ç—å—Å—è –¥–µ–ø–ª–æ—è (2-3 –º–∏–Ω—É—Ç—ã)
- [ ] –û—Ç–∫—Ä—ã—Ç—å –ª–æ–≥–∏
- [ ] –ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫–∏ —Å `[DIAGNOSTIC]`
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –í–°–ï –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏
- [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å –º–Ω–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

**–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —è —Ç–æ—á–Ω–æ —Å–∫–∞–∂—É, –≤ —á—ë–º –ø—Ä–æ–±–ª–µ–º–∞ –∏ –∫–∞–∫ –µ—ë —Ä–µ—à–∏—Ç—å!** üöÄ

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

- `–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê_–ü–†–û–ë–õ–ï–ú–´.md` - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- `EMERGENCY_FIX_RENDER.md` - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (English)
- `RENDER_DASHBOARD_STEPS.txt` - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Render
- `DEPLOYMENT_CHECKLIST.md` - –ü–æ–ª–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è
- `init_db.py` - –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

