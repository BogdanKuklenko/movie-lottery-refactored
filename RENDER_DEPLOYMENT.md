# Инструкция по развертыванию на Render.com

## Проблема
Таблицы для опросов (poll, poll_movie, vote) не созданы в базе данных PostgreSQL на сервере Render.

## Решение

### Шаг 1: Обновление конфигурации на Render.com

1. Зайдите на https://render.com и откройте ваш сервис **movie-lottery**

2. Перейдите в раздел **Settings** (Настройки)

3. Найдите секцию **Build & Deploy**

4. Обновите **Start Command** (Команда запуска):
   ```bash
   bash start.sh
   ```
   
   Или если это не работает, используйте полную версию:
   ```bash
   flask db upgrade && gunicorn -c gunicorn_config.py "movie_lottery:create_app()"
   ```

5. Нажмите **Save Changes** (Сохранить изменения)

### Шаг 2: Загрузка изменений на GitHub

1. Откройте PowerShell в директории проекта

2. Выполните команды:
   ```bash
   git add start.sh RENDER_DEPLOYMENT.md
   git commit -m "Add database migration startup script for Render"
   git push origin codex
   ```

### Шаг 3: Перезапуск сервиса на Render

После загрузки на GitHub, Render автоматически начнет новый деплой.

**Или вы можете запустить вручную:**
1. На странице вашего сервиса нажмите **Manual Deploy** > **Deploy latest commit**
2. Дождитесь завершения деплоя
3. Проверьте логи - должно появиться сообщение "✓ Database migrations completed successfully"

### Шаг 4: Проверка

После успешного деплоя:
1. Откройте ваш сайт: https://movie-lottery.onrender.com
2. Попробуйте создать новый опрос
3. Опрос должен успешно создаться

## Альтернативное решение (если автоматический способ не работает)

Если автоматическая миграция не сработала, вы можете выполнить миграцию вручную через Shell на Render:

1. На странице вашего сервиса в Render найдите **Shell** в верхнем меню
2. Откройте Shell и выполните команду:
   ```bash
   flask db upgrade
   ```
3. Дождитесь завершения и перезапустите сервис

## Что делает скрипт start.sh

Скрипт автоматически:
1. Запускает миграции базы данных (`flask db upgrade`)
2. Создает все необходимые таблицы (poll, poll_movie, vote)
3. Запускает приложение через Gunicorn

Теперь при каждом деплое все миграции будут автоматически применяться к базе данных.

