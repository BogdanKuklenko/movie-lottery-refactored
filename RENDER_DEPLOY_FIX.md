# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –¥–µ–ø–ª–æ—è –Ω–∞ Render.com

**–î–∞—Ç–∞:** 1 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**

---

## –ü—Ä–æ–±–ª–µ–º–∞

Worker'—ã gunicorn –ø–∞–¥–∞–ª–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ —Å –æ—à–∏–±–∫–∞–º–∏:

```
[CRITICAL] WORKER TIMEOUT (pid:xxx)
[ERROR] Worker was sent SIGKILL! Perhaps out of memory?
```

---

## –ü—Ä–∏—á–∏–Ω—ã

### 1. –ë–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

–í `movie_lottery/__init__.py` –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –æ–ø–µ—Ä–∞—Ü–∏—è `db.create_all()` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ worker'–∞:

```python
with app.app_context():
    db.create_all()  # –ë–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–∞ 30+ —Å–µ–∫—É–Ω–¥ –Ω–∞ PostgreSQL!
```

–ù–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–π PostgreSQL —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –±–∞–∑–∞ —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞.

### 2. Timeout –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

Gunicorn –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç timeout = 30 —Å–µ–∫—É–Ω–¥. –ï—Å–ª–∏ worker –Ω–µ –æ—Ç–≤–µ—Ç–∏—Ç –∑–∞ —ç—Ç–æ –≤—Ä–µ–º—è, –æ–Ω —É–±–∏–≤–∞–µ—Ç—Å—è.

### 3. –õ–∏—à–Ω–∏–µ –∏–º–ø–æ—Ä—Ç—ã

–ò–º–ø–æ—Ä—Ç `magnet_search.py` —Å–æ–∑–¥–∞–≤–∞–ª ThreadPoolExecutor, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ç—Ä–µ–±–ª—è–ª —Ä–µ—Å—É—Ä—Å—ã (—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–∞–Ω–µ–µ).

---

## –†–µ—à–µ–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `gunicorn_config.py`

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è Render.com:

```python
# –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
workers = 1              # –¢–æ–ª—å–∫–æ 1 worker –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
timeout = 120           # –£–≤–µ–ª–∏—á–µ–Ω —Å 30 –¥–æ 120 —Å–µ–∫—É–Ω–¥
max_requests = 1000     # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
preload_app = False     # –ù–ï –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
```

### 2. –û—Ç–∫–ª—é—á–µ–Ω `db.create_all()` –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

–í `movie_lottery/__init__.py` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞:

```python
# –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã —Ç–æ–ª—å–∫–æ –≤ dev —Ä–µ–∂–∏–º–µ, –ù–ï –Ω–∞ Render.com
if not os.environ.get('RENDER'):
    with app.app_context():
        db.create_all()
```

Render.com –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `RENDER=true`.

---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é

### –®–∞–≥ 1: –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞ –Ω–∞ Render.com

–ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ Render.com –∏ –∏–∑–º–µ–Ω–∏—Ç–µ **Build Command** –Ω–∞:

```bash
gunicorn --config gunicorn_config.py "movie_lottery:create_app()"
```

**–ò–ª–∏ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:**

```bash
gunicorn -c gunicorn_config.py "movie_lottery:create_app()"
```

**–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ:**

```bash
gunicorn --workers 1 --timeout 120 "movie_lottery:create_app()"
```

### –®–∞–≥ 2: –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

```bash
git add .
git commit -m "Fix: Add gunicorn config and disable db.create_all on production"
git push
```

### –®–∞–≥ 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ)

–ï—Å–ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Render.com –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–¥–∏–Ω —Ä–∞–∑:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Å–∞–π—Ç
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ URL: `https://movie-lottery.onrender.com/init-db/super-secret-key-for-db-init-12345`
3. –≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–í–ê–ñ–ù–û:** –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —É–¥–∞–ª–∏—Ç–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ —ç—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!

---

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ª–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```
[INFO] Starting gunicorn 23.0.0
[INFO] Listening at: http://0.0.0.0:10000
[INFO] Using worker: sync
[INFO] Booting worker with pid: 123

==> Your service is live üéâ
```

**–ù–ï–¢ –±–æ–ª—å—à–µ:**
- ‚ùå WORKER TIMEOUT
- ‚ùå SIGKILL
- ‚ùå –ü–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:

### 1. –£–≤–µ–ª–∏—á–∏—Ç—å timeout –µ—â–µ –±–æ–ª—å—à–µ:

–í `gunicorn_config.py`:
```python
timeout = 180  # 3 –º–∏–Ω—É—Ç—ã
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Render.com –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è.

### 3. –û—Ç–∫–ª—é—á–∏—Ç—å qBittorrent –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:

–ï—Å–ª–∏ qBittorrent –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —ç—Ç–æ —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å worker'—ã.

---

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π

1. ‚úÖ **NEW** `gunicorn_config.py` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è gunicorn
2. ‚úÖ **CHANGED** `movie_lottery/__init__.py` - –æ—Ç–∫–ª—é—á–µ–Ω db.create_all –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
3. ‚úÖ **CHANGED** `movie_lottery/routes/api_routes.py` - —É–±—Ä–∞–Ω –∏–º–ø–æ—Ä—Ç magnet_search (—Ä–∞–Ω–µ–µ)

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. ‚úÖ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
2. ‚úÖ –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ª–æ—Ç–µ—Ä–µ—é
3. ‚úÖ –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É
4. ‚úÖ –ö–Ω–æ–ø–∫–∞ RuTracker —Ä–∞–±–æ—Ç–∞–µ—Ç
5. ‚úÖ –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞–≥–Ω–µ—Ç-—Å—Å—ã–ª–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
6. ‚úÖ –õ–æ–≥–∏ —á–∏—Å—Ç—ã–µ –±–µ–∑ –æ—à–∏–±–æ–∫

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 2.0  
**–¢–∏–ø:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞

