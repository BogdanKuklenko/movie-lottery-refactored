# üîÑ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –æ–ø—Ä–æ—Å –∏ Circuit Breaker –¥–ª—è qBittorrent

**–î–∞—Ç–∞:** 1 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∞–π—Ç –∑–∞–≤–∏—Å–∞–µ—Ç –∫–æ–≥–¥–∞ qBittorrent —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω  
**–†–µ—à–µ–Ω–∏–µ:** Circuit Breaker pattern + –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–ø—Ä–æ—Å–∞

---

## üìã –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **Circuit Breaker Pattern (Backend)**
–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ–Ω–∞–¥–µ–∂–Ω—ã–º–∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

**–¢—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
- `CLOSED` (–ó–∞–∫—Ä—ã—Ç) - –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- `OPEN` (–û—Ç–∫—Ä—ã—Ç) - –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∑–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
- `HALF_OPEN` (–ü–æ–ª—É–æ—Ç–∫—Ä—ã—Ç) - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (CLOSED)
    ‚Üì
2 –æ—à–∏–±–∫–∏ –ø–æ–¥—Ä—è–¥
    ‚Üì
–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (OPEN) - 60 —Å–µ–∫—É–Ω–¥
    ‚Üì
–ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (HALF_OPEN)
    ‚Üì
2 —É—Å–ø–µ—Ö–∞ ‚Üí CLOSED | –û—à–∏–±–∫–∞ ‚Üí OPEN
```

### 2. **–ë—ã—Å—Ç—Ä—ã–µ —Ç–∞–π–º–∞—É—Ç—ã (Backend)**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: 3 —Å–µ–∫—É–Ω–¥—ã
- –ß—Ç–µ–Ω–∏–µ: 5 —Å–µ–∫—É–Ω–¥
- **–ò—Ç–æ–≥–æ:** –ú–∞–∫—Å–∏–º—É–º 8 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –∑–∞–≤–∏—Å–∞–Ω–∏—è

### 3. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–ø—Ä–æ—Å–∞ (Frontend)**
–§—Ä–æ–Ω—Ç–µ–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç —á–∞—Å—Ç–æ—Ç—É –æ–ø—Ä–æ—Å–∞:

| –°–æ—Å—Ç–æ—è–Ω–∏–µ | –ò–Ω—Ç–µ—Ä–≤–∞–ª | –ö–æ–≥–¥–∞ |
|-----------|----------|-------|
| **FAST** | 5 —Å–µ–∫ | qBittorrent —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **MEDIUM** | 15 —Å–µ–∫ | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ |
| **SLOW** | 60 —Å–µ–∫ | qBittorrent –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω |
| **VERY_SLOW** | 120 —Å–µ–∫ | –î–æ–ª–≥–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (> 3 –æ—à–∏–±–æ–∫) |

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend:

#### 1. `movie_lottery/utils/qbittorrent_circuit_breaker.py`
Circuit Breaker —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å:
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (threading.Lock)
- Singleton pattern

#### 2. –û–±–Ω–æ–≤–ª—ë–Ω `movie_lottery/utils/qbittorrent.py`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Circuit Breaker
- –ë—ã—Å—Ç—Ä—ã–µ —Ç–∞–π–º–∞—É—Ç—ã (3 + 5 —Å–µ–∫—É–Ω–¥)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `qbittorrent_available` –≤ –æ—Ç–≤–µ—Ç–µ
- Graceful degradation

#### 3. –û–±–Ω–æ–≤–ª—ë–Ω `movie_lottery/routes/api_routes.py`
–ù–æ–≤—ã–π endpoint: `/api/qbittorrent-status`

**Response:**
```json
{
  "available": true,
  "state": "closed",
  "poll_interval": 5,
  "retry_in": 0,
  "message": "qBittorrent –¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º"
}
```

### Frontend:

#### 4. –û–±–Ω–æ–≤–ª—ë–Ω `movie_lottery/static/js/torrentUpdater.js`
–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ qBittorrent
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å

---

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: qBittorrent –¥–æ—Å—Ç—É–ø–µ–Ω

```
Frontend: –û–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    ‚Üì
Backend: –ó–∞–ø—Ä–æ—Å –∫ qBittorrent (—Ç–∞–π–º–∞—É—Ç 8 —Å–µ–∫)
    ‚Üì
Backend: –£—Å–ø–µ—Ö ‚úÖ
    ‚Üì
Circuit Breaker: –û—Å—Ç–∞—ë—Ç—Å—è –≤ CLOSED
    ‚Üì
Frontend: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—Ä—Ä–µ–Ω—Ç—ã
    ‚Üì
Frontend: –°–ª–µ–¥—É—é—â–∏–π –æ–ø—Ä–æ—Å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: qBittorrent —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

```
Frontend: –û–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    ‚Üì
Backend: –ó–∞–ø—Ä–æ—Å –∫ qBittorrent
    ‚Üì
Backend: Timeout –ø–æ—Å–ª–µ 8 —Å–µ–∫—É–Ω–¥ ‚ö†Ô∏è
    ‚Üì
Circuit Breaker: –û—à–∏–±–∫–∞ #1
    ‚Üì
Frontend: –û–ø—Ä–æ—Å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ (–µ—â—ë –ø—ã—Ç–∞–µ–º—Å—è)
    ‚Üì
Backend: –°–Ω–æ–≤–∞ timeout ‚ö†Ô∏è
    ‚Üì
Circuit Breaker: –û—à–∏–±–∫–∞ #2 ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –≤ OPEN ‚ùå
    ‚Üì
Frontend: –ü–æ–ª—É—á–∞–µ—Ç qbittorrent_available: false
    ‚Üì
Frontend: –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –æ–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
    ‚Üì
Backend: –ó–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ (–Ω–µ –∂–¥—ë–º —Ç–∞–π–º–∞—É—Ç–∞!)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- –°–∞–π—Ç **–Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç**, –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –†–µ—Å—É—Ä—Å—ã –Ω–µ —Ç—Ä–∞—Ç—è—Ç—Å—è –Ω–∞ –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- –†–µ–¥–∫–∏–π –æ–ø—Ä–æ—Å –Ω–µ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: qBittorrent –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

```
Frontend: –û–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ (OPEN)
    ‚Üì
–ü—Ä–æ—à–ª–æ 60 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—à–∏–±–∫–∏
    ‚Üì
Circuit Breaker: OPEN ‚Üí HALF_OPEN
    ‚Üì
Backend: –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å (–ø—Ä–æ–≤–µ—Ä–∫–∞)
    ‚Üì
Backend: –ó–∞–ø—Ä–æ—Å –∫ qBittorrent
    ‚Üì
Backend: –£—Å–ø–µ—Ö! ‚úÖ
    ‚Üì
Circuit Breaker: –£—Å–ø–µ—Ö #1 (–Ω—É–∂–Ω–æ 2)
    ‚Üì
Frontend: –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –æ–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥ (MEDIUM)
    ‚Üì
Backend: –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ 15 —Å–µ–∫
    ‚Üì
Backend: –°–Ω–æ–≤–∞ —É—Å–ø–µ—Ö! ‚úÖ
    ‚Üì
Circuit Breaker: –£—Å–ø–µ—Ö #2 ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –≤ CLOSED
    ‚Üì
Frontend: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –æ–ø—Ä–æ—Å—É –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    ‚Üì
Console: "[TorrentUpdater] ‚úÖ qBittorrent –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
**–ù–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å!** –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

- –°–∞–π—Ç **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç**
- –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ qBittorrent —Å–∞–π—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Circuit Breaker (Backend):
```python
from movie_lottery.utils.qbittorrent_circuit_breaker import get_circuit_breaker

breaker = get_circuit_breaker()
print(breaker.get_state())
# {'state': 'closed', 'available': True, 'failure_count': 0, ...}
```

#### –°–±—Ä–æ—Å–∏—Ç—å Circuit Breaker:
```python
from movie_lottery.utils.qbittorrent_circuit_breaker import reset_circuit_breaker

reset_circuit_breaker()
```

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ API:
```bash
curl https://your-app.com/api/qbittorrent-status
```

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –∏ —Å—Ç–∞—Ç—É—Å
console.log(window.torrentUpdater.getDebugInfo());

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// {
//   currentInterval: "5 —Å–µ–∫",
//   failureCount: 0,
//   qbitStatus: { available: true, state: "closed", ... },
//   isPolling: true
// }
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

### –î–û (–±–µ–∑ Circuit Breaker):

```
qBittorrent –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    ‚Üì
–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∂–¥—ë—Ç 30+ —Å–µ–∫—É–Ω–¥ (timeout –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    ‚Üì
–°–∞–π—Ç –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–∞–π—Ç–æ–º
    ‚Üì
–°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –°–∞–π—Ç –∑–∞–≤–∏—Å–∞–µ—Ç
- ‚ùå –ü–ª–æ—Ö–æ–π UX
- ‚ùå –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- ‚ùå Timeout worker'–æ–≤

### –ü–û–°–õ–ï (—Å Circuit Breaker):

```
qBittorrent –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    ‚Üì
–ü–µ—Ä–≤—ã–µ 2 –∑–∞–ø—Ä–æ—Å–∞: —Ç–∞–π–º–∞—É—Ç –∑–∞ 8 —Å–µ–∫—É–Ω–¥ (–±—ã—Å—Ç—Ä–æ!)
    ‚Üì
Circuit Breaker: OPEN
    ‚Üì
–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã: –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ
    ‚Üì
Frontend: –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Ä–µ–¥–∫–∏–π –æ–ø—Ä–æ—Å (60 —Å–µ–∫)
    ‚Üì
–°–∞–π—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ!
    ‚Üì
–ß–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –°–∞–π—Ç **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç**
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã (8 —Å–µ–∫ –º–∞–∫—Å.)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

---

## üé® –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

### –ö–æ–≥–¥–∞ qBittorrent –¥–æ—Å—Ç—É–ø–µ–Ω:
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- –ü–ª–∞–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –Ω–∏–∫–∞–∫–∏—Ö –∑–∞–¥–µ—Ä–∂–µ–∫

### –ö–æ–≥–¥–∞ qBittorrent –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
- –°–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫
- –ö–Ω–æ–ø–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏ (–Ω–æ –Ω–µ –∑–∞–≤–∏—Å–∞—é—Ç!)
- –°—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ä–µ–¥–∫–æ (–Ω–µ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

### –ö–æ–≥–¥–∞ qBittorrent –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ 60 —Å–µ–∫)
- –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º—É —Ä–µ–∂–∏–º—É
- –õ–æ–≥ –≤ –∫–æ–Ω—Å–æ–ª–∏: "‚úÖ qBittorrent –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Circuit Breaker:

–í `movie_lottery/utils/qbittorrent_circuit_breaker.py`, —Ñ—É–Ω–∫—Ü–∏—è `get_circuit_breaker()`:

```python
_circuit_breaker = QBittorrentCircuitBreaker(
    failure_threshold=2,    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –¥–æ OPEN
    timeout=60.0,           # –°–µ–∫—É–Ω–¥ –¥–æ –ø–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
    success_threshold=2     # –£—Å–ø–µ—Ö–æ–≤ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ CLOSED
)
```

### –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

–í `movie_lottery/utils/qbittorrent.py`:

```python
QBIT_CONNECT_TIMEOUT = 3  # —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
QBIT_READ_TIMEOUT = 5      # —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ
```

### –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–ø—Ä–æ—Å–∞:

–í `movie_lottery/static/js/torrentUpdater.js`:

```javascript
this.INTERVALS = {
    FAST: 5000,      // 5 —Å–µ–∫ - –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
    MEDIUM: 15000,   // 15 —Å–µ–∫ - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
    SLOW: 60000,     // 60 —Å–µ–∫ - –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    VERY_SLOW: 120000 // 2 –º–∏–Ω - –¥–æ–ª–≥–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
};
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### Backend –ª–æ–≥–∏:

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

–õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç:
```
Circuit Breaker initialized: failures=2, timeout=60.0s, successes=2
qBittorrent: –ø–æ–ª—É—á–µ–Ω–æ 5 —Ç–æ—Ä—Ä–µ–Ω—Ç–æ–≤
Circuit Breaker: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ø–æ—Ä–æ–≥ –æ—à–∏–±–æ–∫ (2), –ø–µ—Ä–µ—Ö–æ–¥ –≤ OPEN
Circuit Breaker: –ü–µ—Ä–µ—Ö–æ–¥ –≤ HALF_OPEN, –ø—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
Circuit Breaker: –£—Å–ø–µ—Ö –≤ HALF_OPEN (1/2)
Circuit Breaker: –ü–µ—Ä–µ—Ö–æ–¥ –≤ CLOSED, qBittorrent –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!
```

### Frontend –ª–æ–≥–∏:

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12), —É–≤–∏–¥–∏—Ç–µ:
```
[TorrentUpdater] –°–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫
[TorrentUpdater] ‚ö†Ô∏è qBittorrent –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–ø–æ–ø—ã—Ç–∫–∞ 1)
[TorrentUpdater] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞: 5—Å ‚Üí 60—Å
[TorrentUpdater] –°–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 60 —Å–µ–∫
[TorrentUpdater] ‚úÖ qBittorrent –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!
[TorrentUpdater] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞: 60—Å ‚Üí 5—Å
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### API Endpoint –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

```bash
curl https://your-app.com/api/qbittorrent-status
```

–û—Ç–≤–µ—Ç –ø–æ–∫–∞–∂–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∏ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å –ø—Ä–æ–±–ª–µ–º—ã:

```json
{
  "available": false,
  "state": "open",
  "poll_interval": 60,
  "retry_in": 45.3,
  "message": "qBittorrent –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 45 —Å–µ–∫"
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º:

–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã:
- –ï—Å–ª–∏ `state == "open"` –±–æ–ª—å—à–µ 5 –º–∏–Ω—É—Ç ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- –ï—Å–ª–∏ `failureCount > 10` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞

---

## ‚úÖ Checklist –¥–ª—è –¥–µ–ø–ª–æ—è

- [ ] –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- [ ] –ó–∞–ø—É—à–∏—Ç—å –Ω–∞ GitHub
- [ ] –î–æ–∂–¥–∞—Ç—å—Å—è –¥–µ–ø–ª–æ—è –Ω–∞ Render
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `/api/qbittorrent-status` endpoint
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –ª–æ–≥–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º qBittorrent:
  - [ ] –°–∞–π—Ç –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç
  - [ ] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Ä–µ–¥–∫–∏–π –æ–ø—Ä–æ—Å
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ gracefully
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
  - [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ
  - [ ] –í–æ–∑–≤—Ä–∞—Ç –∫ —á–∞—Å—Ç–æ–º—É –æ–ø—Ä–æ—Å—É

---

## üéØ –ò—Ç–æ–≥–æ

### –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! ‚úÖ

**–ë—ã–ª–æ:**
- –°–∞–π—Ç –∑–∞–≤–∏—Å–∞–µ—Ç –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ qBittorrent
- Timeout worker'–æ–≤
- –ü–ª–æ—Ö–æ–π UX

**–°—Ç–∞–ª–æ:**
- –°–∞–π—Ç **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç**
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ–ø—Ä–æ—Å–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- Graceful degradation
- –û—Ç–ª–∏—á–Ω—ã–π UX

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- **Circuit Breaker Pattern** (–∫–∞–∫ –≤ Netflix Hystrix)
- **Adaptive Polling** (—É–º–Ω—ã–π –æ–ø—Ä–æ—Å)
- **Graceful Degradation** (—Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ —Å–±–æ—è—Ö)
- **Fast Fail** (–±—ã—Å—Ç—Ä—ã–µ —Ç–∞–π–º–∞—É—Ç—ã)

**Production-ready —Ä–µ—à–µ–Ω–∏–µ! üöÄ**

